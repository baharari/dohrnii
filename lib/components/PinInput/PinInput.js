var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));var _react=_interopRequireDefault(require("react"));var _reactNative=require("react-native");var _Text=_interopRequireDefault(require("../Text/Text"));var _theme=require("../../theme");var _styles=_interopRequireDefault(require("./styles"));var _types=require("./types");var _Input=_interopRequireDefault(require("../Input/Input"));var _providers=require("../../providers");var _jsxRuntime=require("react/jsx-runtime");var _excluded=["label","error","length","placeholder","type","value","onChange","mask","style","labelStyle","errorStyle","inputStyle"];var _this=this,_jsxFileName="/Users/limonagaci/Desktop/app/dohrnii/src/components/PinInput/PinInput.js";var sanitizeChars=function sanitizeChars(text,type){if(!text)return'';var str=String(text);if(type==='number'){return str.replace(/[^0-9]/g,'');}return str.replace(/[^a-zA-Z0-9]/g,'');};var PinInput=function PinInput(props){var _PinInputDefaultProps=Object.assign({},_types.PinInputDefaultProps,props),label=_PinInputDefaultProps.label,error=_PinInputDefaultProps.error,length=_PinInputDefaultProps.length,placeholder=_PinInputDefaultProps.placeholder,type=_PinInputDefaultProps.type,value=_PinInputDefaultProps.value,onChange=_PinInputDefaultProps.onChange,mask=_PinInputDefaultProps.mask,style=_PinInputDefaultProps.style,labelStyle=_PinInputDefaultProps.labelStyle,errorStyle=_PinInputDefaultProps.errorStyle,inputStyle=_PinInputDefaultProps.inputStyle,rest=(0,_objectWithoutProperties2.default)(_PinInputDefaultProps,_excluded);var _useTheme=(0,_providers.useTheme)(),themeMode=_useTheme.theme;var styles=(0,_styles.default)(themeMode);var pinLength=Math.max(1,Number(length)||_types.PinInputDefaultProps.length);var _React$useState=_react.default.useState(function(){var initial=(value||'').slice(0,pinLength);var arr=Array(pinLength).fill('');for(var i=0;i<initial.length;i++)arr[i]=initial[i];return arr;}),_React$useState2=(0,_slicedToArray2.default)(_React$useState,2),pins=_React$useState2[0],setPins=_React$useState2[1];_react.default.useEffect(function(){var src=(value||'').slice(0,pinLength);setPins(function(prev){var next=Array(pinLength).fill('');for(var i=0;i<src.length;i++)next[i]=src[i];return next;});},[value,pinLength]);var inputsRef=_react.default.useRef([]);var emitChange=function emitChange(nextPins){var s=nextPins.join('');if(onChange)onChange(s);};var focusIndex=function focusIndex(idx){var ref=inputsRef.current[idx];if(ref&&ref.focus)ref.focus();};var handleChangeAt=function handleChangeAt(idx,text){var sanitized=sanitizeChars(text,type);var chars=sanitized.split('');setPins(function(prev){var next=(0,_toConsumableArray2.default)(prev);var cursor=idx;for(var c of chars){if(cursor>=pinLength)break;next[cursor]=c;cursor+=1;}var nextFocus=Math.min(cursor,pinLength-1);if(chars.length>0)focusIndex(nextFocus);emitChange(next);return next;});};var handleKeyPressAt=function handleKeyPressAt(idx,e){var _e$nativeEvent;if((e==null||(_e$nativeEvent=e.nativeEvent)==null?void 0:_e$nativeEvent.key)==='Backspace'){setPins(function(prev){var next=(0,_toConsumableArray2.default)(prev);if(next[idx]){next[idx]='';emitChange(next);return next;}var prevIdx=Math.max(0,idx-1);next[prevIdx]='';focusIndex(prevIdx);emitChange(next);return next;});}};var perInputCommonProps={placeholder:placeholder?placeholder:'o',secureTextEntry:!!mask,keyboardType:type==='number'?'number-pad':'default'};var pinInputs=Array.from({length:pinLength}).map(function(_,idx){var isLast=idx===pinLength-1;return(0,_jsxRuntime.jsx)(_reactNative.View,{style:[styles.pinBox,isLast?{marginRight:0}:null],children:(0,_jsxRuntime.jsx)(_Input.default,Object.assign({ref:function ref(r){return inputsRef.current[idx]=r;},value:pins[idx],onChangeText:function onChangeText(t){return handleChangeAt(idx,t);},onKeyPress:function onKeyPress(e){return handleKeyPressAt(idx,e);},inputStyle:[styles.centerInputText,{width:"100%",height:"100%",aspectRatio:1,fontWeight:"600"},inputStyle],style:{paddingHorizontal:0,aspectRatio:1}},perInputCommonProps,rest))},`pin-${idx}`);});return(0,_jsxRuntime.jsxs)(_reactNative.View,{style:[styles.container,style],children:[label?typeof label==='string'?(0,_jsxRuntime.jsx)(_Text.default,{fontWeight:"500",style:[styles.label,labelStyle],children:label}):label:null,(0,_jsxRuntime.jsx)(_reactNative.View,{style:styles.pinsRow,children:pinInputs}),error?(0,_jsxRuntime.jsx)(_Text.default,{size:"xs",style:[styles.errorText,errorStyle],children:error}):null]});};PinInput.propTypes=_types.PinInputPropTypes;PinInput.defaultProps=_types.PinInputDefaultProps;var _default=exports.default=PinInput;
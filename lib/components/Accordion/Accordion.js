var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));var _react=_interopRequireDefault(require("react"));var _reactNative=require("react-native");var _Text=_interopRequireDefault(require("../Text/Text"));var _providers=require("../../providers");var _theme=require("../../theme");var _styles=_interopRequireDefault(require("./styles"));var _types=require("./types");var _Item=_interopRequireDefault(require("./Item"));var _Control=_interopRequireDefault(require("./Control"));var _Panel=_interopRequireDefault(require("./Panel"));var _jsxRuntime=require("react/jsx-runtime");var _excluded=["variant","borderRadius","defaultValue","value","onChange","multiple","style","children"];var _this=this,_jsxFileName="/Users/limonagaci/Desktop/app/dohrnii/src/components/Accordion/Accordion.js";var defaultChevron=require('../../assets/icons/chevron-down.png');var Accordion=function Accordion(props){var _useTheme=(0,_providers.useTheme)(),themeMode=_useTheme.theme;var styles=(0,_styles.default)(themeMode);var _AccordionDefaultProp=Object.assign({},_types.AccordionDefaultProps,props),variant=_AccordionDefaultProp.variant,borderRadius=_AccordionDefaultProp.borderRadius,defaultValue=_AccordionDefaultProp.defaultValue,value=_AccordionDefaultProp.value,onChange=_AccordionDefaultProp.onChange,multiple=_AccordionDefaultProp.multiple,style=_AccordionDefaultProp.style,children=_AccordionDefaultProp.children,rest=(0,_objectWithoutProperties2.default)(_AccordionDefaultProp,_excluded);var isControlled=value!==undefined;var _React$useState=_react.default.useState(defaultValue),_React$useState2=(0,_slicedToArray2.default)(_React$useState,2),internal=_React$useState2[0],setInternal=_React$useState2[1];var getActiveValues=_react.default.useCallback(function(){if(multiple){var vals=isControlled?value:internal;return Array.isArray(vals)?vals:vals!=null?[vals]:[];}var val=isControlled?value:internal;return val!=null?[val]:[];},[multiple,isControlled,value,internal]);var setActive=_react.default.useCallback(function(nextValue){if(multiple){var current=getActiveValues();var exists=current.includes(nextValue);var newValues=exists?current.filter(function(v){return v!==nextValue;}):[].concat((0,_toConsumableArray2.default)(current),[nextValue]);if(!isControlled)setInternal(newValues);onChange==null||onChange(newValues);}else{var _current=getActiveValues()[0];var newValue=_current===nextValue?undefined:nextValue;if(!isControlled)setInternal(newValue);onChange==null||onChange(newValue);}},[multiple,isControlled,onChange,getActiveValues]);var items=_react.default.Children.toArray(children).filter(function(child){return child&&child.type&&child.type.displayName==='AccordionItem';});var variantStyle=styles.getVariant(variant);var base=styles.base;return(0,_jsxRuntime.jsx)(_reactNative.View,Object.assign({style:[base.container,style]},rest,{children:items.map(function(item,idx){var itemValue=item.props.value;var disabled=!!item.props.disabled;var itemStyle=item.props.style;var childNodes=_react.default.Children.toArray(item.props.children);var controlNode=childNodes.find(function(c){var _c$type;return(c==null||(_c$type=c.type)==null?void 0:_c$type.displayName)==='AccordionControl';});var panelNode=childNodes.find(function(c){var _c$type2;return(c==null||(_c$type2=c.type)==null?void 0:_c$type2.displayName)==='AccordionPanel';});var isActive=getActiveValues().includes(itemValue);return(0,_jsxRuntime.jsx)(AccordionItemWithAnimation,{isActive:isActive,disabled:disabled,itemValue:itemValue,setActive:setActive,borderRadius:borderRadius,base:base,variantStyle:variantStyle,itemStyle:itemStyle,controlNode:controlNode,panelNode:panelNode},String(itemValue)||`item-${idx}`);})}));};var AccordionItemWithAnimation=function AccordionItemWithAnimation(_ref){var _panelNode$props,_panelNode$props2;var isActive=_ref.isActive,disabled=_ref.disabled,itemValue=_ref.itemValue,setActive=_ref.setActive,borderRadius=_ref.borderRadius,base=_ref.base,variantStyle=_ref.variantStyle,itemStyle=_ref.itemStyle,controlNode=_ref.controlNode,panelNode=_ref.panelNode;var animatedHeight=_react.default.useRef(new _reactNative.Animated.Value(0)).current;var animatedOpacity=_react.default.useRef(new _reactNative.Animated.Value(0)).current;var _React$useState3=_react.default.useState(0),_React$useState4=(0,_slicedToArray2.default)(_React$useState3,2),contentHeight=_React$useState4[0],setContentHeight=_React$useState4[1];var _React$useState5=_react.default.useState(false),_React$useState6=(0,_slicedToArray2.default)(_React$useState5,2),measured=_React$useState6[0],setMeasured=_React$useState6[1];_react.default.useEffect(function(){if(isActive&&contentHeight>0){_reactNative.Animated.parallel([_reactNative.Animated.timing(animatedHeight,{toValue:contentHeight,duration:300}),_reactNative.Animated.timing(animatedOpacity,{toValue:1,duration:300})]).start();}else if(!isActive){_reactNative.Animated.parallel([_reactNative.Animated.timing(animatedHeight,{toValue:0,duration:300}),_reactNative.Animated.timing(animatedOpacity,{toValue:0,duration:300})]).start();}},[isActive,contentHeight]);var handleLayout=function handleLayout(event){var height=event.nativeEvent.layout.height;if(height>0&&!measured){setContentHeight(height);setMeasured(true);}};return(0,_jsxRuntime.jsxs)(_reactNative.View,{style:[base.item,{borderRadius:borderRadius},variantStyle.item,variantStyle.item&&{backgroundColor:(0,_theme.processColorValue)(variantStyle.item.backgroundColor),borderColor:(0,_theme.processColorValue)(variantStyle.item.borderColor)},isActive&&variantStyle.activeItem&&{backgroundColor:(0,_theme.processColorValue)(variantStyle.activeItem.backgroundColor)},itemStyle],children:[(0,_jsxRuntime.jsxs)(_reactNative.Pressable,{disabled:disabled,onPress:function onPress(){return disabled?null:setActive(itemValue);},style:[base.controlBase,disabled&&base.disabled,variantStyle.control],children:[controlNode?typeof controlNode.props.children==='string'?(0,_jsxRuntime.jsx)(_Text.default,{style:base.controlText,children:controlNode.props.children}):controlNode.props.children:null,(0,_jsxRuntime.jsx)(_reactNative.Image,{source:defaultChevron,style:base.chevron,resizeMode:"contain"})]}),(0,_jsxRuntime.jsx)(_reactNative.Animated.View,{style:{height:animatedHeight,opacity:animatedOpacity,overflow:'hidden'},children:(0,_jsxRuntime.jsx)(_reactNative.View,{style:[base.panelBase,variantStyle.panel,disabled&&base.disabled,panelNode==null||(_panelNode$props=panelNode.props)==null?void 0:_panelNode$props.style],children:panelNode?panelNode.props.children:null})}),(0,_jsxRuntime.jsx)(_reactNative.View,{style:{position:'absolute',opacity:0,zIndex:-1},onLayout:handleLayout,children:(0,_jsxRuntime.jsx)(_reactNative.View,{style:[base.panelBase,variantStyle.panel,disabled&&base.disabled,panelNode==null||(_panelNode$props2=panelNode.props)==null?void 0:_panelNode$props2.style],children:panelNode?panelNode.props.children:null})})]});};Accordion.propTypes=_types.AccordionPropTypes;Accordion.Item=_Item.default;Accordion.Control=_Control.default;Accordion.Panel=_Panel.default;var _default=exports.default=Accordion;